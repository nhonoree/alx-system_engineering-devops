#!/usr/bin/env bash
# This script ensures that Nginx is listening on port 80

# Update package list and install Nginx if not installed
apt update
apt install -y nginx

# Check if Nginx is already running
if ! pgrep -x "nginx" > /dev/null; then
    echo "Nginx is not running. Starting Nginx..."
    systemctl start nginx
else
    echo "Nginx is already running."
fi

# Ensure Nginx is enabled to start on boot
systemctl enable nginx

# Check if Nginx is listening on port 80
if ! ss -tuln | grep ':80' > /dev/null; then
    echo "Nginx is not listening on port 80. Fixing this..."
    
    # Check if configuration is correct and edit if necessary
    sed -i 's/# listen 80;/listen 80;/' /etc/nginx/sites-available/default
    
    # Reload Nginx to apply the changes
    systemctl reload nginx
    echo "Nginx is now listening on port 80."
else
    echo "Nginx is correctly listening on port 80."
fi
